{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block content %}
	<div class="container-xxl pt-5">
		<div class="container pb-4 pt-3">
			<h1 class="text-center">Источники данных</h1>
			<p class="text-muted text-center">Добавьте ваши данные для обучения чат-бота.</p>
		</div>
		<div class="row">
			<div class="col-md-2 pe-4">
				<nav class="navbar navbar-light w-100">
					<ul class="navbar-nav flex-column w-100">
						<li class="nav-item">
							<div class="row justify-content-between align-items-center btn-google rounded">
								<div class="col-auto">
									<a class="nav-link active" href="#"><b>Файлы</b>	</a>
								</div>
								<div class="col-auto">
									<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-file-earmark" viewBox="0 0 18 18">
										<path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z"></path>
									</svg>
								</div>
							</div>
						</li>
						<li class="nav-item">
							<div class="row justify-content-between align-items-center btn-google rounded">
								<div class="col-auto">
									<a class="nav-link active" href="#">Текст</a>
								</div>
								<div class="col-auto">
									<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-card-text" viewBox="0 0 18 18">
										<path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"></path>
										<path d="M3 5.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 8zm0 2.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z"></path>
									</svg>
								</div>
							</div>
						</li>
						<li class="nav-item">
							<div class="row justify-content-between align-items-center btn-google rounded">
								<div class="col-auto">
									<a class="nav-link active" href="#">Вопрос-ответ</a>
								</div>
								<div class="col-auto">
									<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="text-gray-400 group-hover:text-violet-600 h-6 w-6 shrink-0">
										<path stroke-linecap="round" stroke-linejoin="round" d="M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 01-.825-.242m9.345-8.334a2.126 2.126 0 00-.476-.095 48.64 48.64 0 00-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0011.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155"></path>
									</svg>
								</div>
							</div>
						</li>
						<li class="nav-item">
							<div class="row justify-content-between align-items-center btn-google rounded">
								<div class="col-auto">
									<a class="nav-link active" href="#">Сайт</a>
								</div>
								<div class="col-auto">
									<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-globe" viewBox="0 0 18 18">
										<path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855A7.97 7.97 0 0 0 5.145 4H7.5V1.077zM4.09 4a9.267 9.267 0 0 1 .64-1.539 6.7 6.7 0 0 1 .597-.933A7.025 7.025 0 0 0 2.255 4H4.09zm-.582 3.5c.03-.877.138-1.718.312-2.5H1.674a6.958 6.958 0 0 0-.656 2.5h2.49zM4.847 5a12.5 12.5 0 0 0-.338 2.5H7.5V5H4.847zM8.5 5v2.5h2.99a12.495 12.495 0 0 0-.337-2.5H8.5zM4.51 8.5a12.5 12.5 0 0 0 .337 2.5H7.5V8.5H4.51zm3.99 0V11h2.653c.187-.765.306-1.608.338-2.5H8.5zM5.145 12c.138.386.295.744.468 1.068.552 1.035 1.218 1.65 1.887 1.855V12H5.145zm.182 2.472a6.696 6.696 0 0 1-.597-.933A9.268 9.268 0 0 1 4.09 12H2.255a7.024 7.024 0 0 0 3.072 2.472zM3.82 11a13.652 13.652 0 0 1-.312-2.5h-2.49c.062.89.291 1.733.656 2.5H3.82zm6.853 3.472A7.024 7.024 0 0 0 13.745 12H11.91a9.27 9.27 0 0 1-.64 1.539 6.688 6.688 0 0 1-.597.933zM8.5 12v2.923c.67-.204 1.335-.82 1.887-1.855.173-.324.33-.682.468-1.068H8.5zm3.68-1h2.146c.365-.767.594-1.61.656-2.5h-2.49a13.65 13.65 0 0 1-.312 2.5zm2.802-3.5a6.959 6.959 0 0 0-.656-2.5H12.18c.174.782.282 1.623.312 2.5h2.49zM11.27 2.461c.247.464.462.98.64 1.539h1.835a7.024 7.024 0 0 0-3.072-2.472c.218.284.418.598.597.933zM10.855 4a7.966 7.966 0 0 0-.468-1.068C9.835 1.897 9.17 1.282 8.5 1.077V4h2.355z"></path>
									</svg>
								</div>
							</div>
						</li>
					</ul>
				</nav>
			</div>

			<div class="col-md-7 p-4 d-flex justify-content-center border flex-column">
				<div>
					<h3>Files</h3>
					<hr class="my-4">
				</div>
				<div id="file-drop-area" class="container border d-flex flex-column align-items-center justify-content-center" style="min-height: 30vh;">
					<p>Drop file here</p>
					<p class="small">.pdf, .doc, .docx, .txt</p>
					<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-file-earmark-arrow-down" viewBox="0 0 16 16">
						<path d="M8.5 6.5a.5.5 0 0 0-1 0v3.793L6.354 9.146a.5.5 0 1 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L8.5 10.293V6.5z"></path>
						<path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"></path>
					</svg>
					<form enctype="multipart/form-data" id="file-send-form" method="post" action="{% url 'chats:submit_files' chat_uuid %}">
						{% csrf_token %}
						<input type="file" id="file-input" name="file" style="display: none;" multiple>
					</form>
				</div>
				{% if chat_files %}
					<div class="d-flex align-items-center my-4 mb-2">
						<hr class="w-100 my-4">
						<span class="px-2 text-nowrap">Прикрепленные файлы</span>
						<hr class="w-100 my-4">
					</div>
					{% for chat_file in chat_files %}
						<div class="d-flex align-items-center justify-content-between">
							<div class="py-2">
								<span class="fw-bold">{{ chat_file.file_name }}</span>
								<span class="text-muted">({{ chat_file.character_length }} символов)</span>
							</div>
							<div id="delete-box-{{ forloop.counter }}" style="color: indianred; cursor: pointer;" data-form-id="delete-form-{{ forloop.counter }}">
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16">
									<path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"></path>
								</svg>
							</div>
						<form id="delete-form-{{ forloop.counter }}" method="post" action="{% url 'chats:delete-file' chat_uuid chat_file.id%}" style="display: none">
							{% csrf_token %}
						</form>
						</div>
					{% endfor %}
				{% endif %}
			</div>

			<div class="col-md-3">
				<div class=" border p-4">
					<div class="text-center fw-bold mb-2">Источники</div>
						<div class="mb-4"></div>
								<span class="">Всего обнаружено символов </span>
								<span class="d-flex justify-content-center">
									<span class="fw-bold">{{ smartchat_characters }}</span>
									<span class="text-muted"> / {{ chat_character_limit|intcomma }}</span>
								</span>
							<button class="btn btn-dark w-100 mt-4" type="submit">Create Chatbot</button>
				</div>
			</div>

		</div>
	</div>
{% endblock %}

{% block domready %}
	const fileDropArea = document.getElementById('file-drop-area');
	const fileInput = document.getElementById('file-input');
	const fileForm = document.getElementById('file-send-form');

	fileDropArea.addEventListener('click', () => {
		fileInput.click();
	});

	fileDropArea.addEventListener('dragover', (e) => {
		e.preventDefault();
{#		fileDropArea.classList.add('dragover');#}
	});

	fileDropArea.addEventListener('dragleave', () => {
{#		fileDropArea.classList.remove('dragover');#}
	});

	fileDropArea.addEventListener('drop', (e) => {
		e.preventDefault();
		const files = e.dataTransfer.files;
		if (files.length > 0 && files.length < 11) {
			fileInput.files = files;
			console.log(fileInput.files)
			fileForm.submit()
		}
	});
	fileInput.addEventListener('change', () => {
		console.log(fileInput.files);
		fileForm.submit()
	});

	const deleteIcons = document.querySelectorAll("[data-form-id]");

	deleteIcons.forEach(function (deleteIcon) {
			deleteIcon.addEventListener("click", function () {
					const formId = this.getAttribute("data-form-id");
					const deleteForm = document.getElementById(formId);
					if (deleteForm) {
							deleteForm.submit();
					}
			});
	});
{% endblock %}
